<div class="container">
  <h1>Yapla Members CSV Exporter</h1>
  <p class="preview-note">Upload an Excel file, map the columns, and export a clean CSV for Yapla.</p>

  <section class="upload-section">
    <h2>1) Upload Excel</h2>
    <div class="form-group">
      <label for="excelFile">Choose .xlsx or .xls file</label>
      <input id="excelFile" type="file" accept=".xlsx,.xls" (change)="onFileChange($event)"/>
    </div>

    @if (parseError) {
      <div class="error-message">{{ parseError }}</div>
    }
  </section>

  @if (headers.length) {
    <section class="mapping-section">
      <h2>2) Map Columns</h2>
      <p class="preview-note">Select which columns correspond to each field.</p>
      <div style="display:grid; grid-template-columns: repeat(2, minmax(240px, 1fr)); gap: 1rem;">
        <div class="form-group">
          <label>First Name</label>
          <select [(ngModel)]="firstNameCol">
            <option [ngValue]="null" disabled selected>Choose column</option>
            @for (h of headers; track h) {
              <option [ngValue]="h">{{ h }}</option>
            }
          </select>
        </div>
        <div class="form-group">
          <label>Last Name</label>
          <select [(ngModel)]="lastNameCol">
            <option [ngValue]="null" disabled selected>Choose column</option>
            @for (h of headers; track h) {
              <option [ngValue]="h">{{ h }}</option>
            }
          </select>
        </div>
        <div class="form-group">
          <label>Adhesion Start</label>
          <select [(ngModel)]="adhesionStartCol">
            <option [ngValue]="null" disabled selected>Choose column</option>
            @for (h of headers; track h) {
              <option [ngValue]="h">{{ h }}</option>
            }
          </select>
        </div>
        <div class="form-group">
          <label>Adhesion End</label>
          <select [(ngModel)]="adhesionEndCol">
            <option [ngValue]="null" disabled selected>Choose column</option>
            @for (h of headers; track h) {
              <option [ngValue]="h">{{ h }}</option>
            }
          </select>
        </div>
      </div>
    </section>

    <section class="preview-section">
      <h2>3) Export</h2>
      <div class="form-group">
        <label>Export file name</label>
        <input type="text" [(ngModel)]="exportPath" placeholder="adherent.csv" readonly>
      </div>
      <button (click)="exportData()" [disabled]="!canExport">Export CSV</button>
      @if (!canExport) {
        <p class="preview-note">Select all four fields to enable export.</p>
      }

      @if (statusMessage) {
        <div class="status-message">
          <pre>{{ statusMessage }}</pre>
        </div>
      }
    </section>
  }
</div>

<router-outlet/>
