<div class="container">
  <h1>Exportateur CSV pour Membres Yapla</h1>
  <p class="preview-note">Téléchargez un fichier Excel ou CSV, associez les colonnes et exportez un CSV propre pour Yapla.</p>

  <section class="upload-section">
    <h2>Télécharger</h2>
    <div class="form-group">
      <label for="excelFile">Choisir un fichier .xlsx, .xls ou .csv</label>
      <input id="excelFile" type="file" accept=".xlsx,.xls,.csv" (change)="onFileChange($event)"/>
    </div>

    <div class="dropzone"
         (drop)="onFileDrop($event)"
         (dragover)="onDragOver($event)">
      Glissez-déposez votre fichier ici
    </div>

    @if (parseError) {
      <div class="error-message">{{ parseError }}</div>
    }
  </section>

  @if (headers.length) {
    <section class="mapping-section">
      <h2>Association des Colonnes</h2>
      <p class="preview-note">Sélectionnez les colonnes correspondant à chaque champ dans votre fichier Excel.</p>
      <div class="column-grid" style="display:grid; grid-template-columns: repeat(2, minmax(240px, 1fr)); gap: 1.5rem;">
        <div class="form-group">
          <label>Prénom</label>
          <select [(ngModel)]="firstNameCol" (ngModelChange)="onMappingChange()">
            <option [ngValue]="null" disabled selected>Choisir une colonne</option>
            @for (h of headers; track h) {
              <option [ngValue]="h">{{ h }}</option>
            }
          </select>
        </div>
        <div class="form-group">
          <label>Nom</label>
          <select [(ngModel)]="lastNameCol" (ngModelChange)="onMappingChange()">
            <option [ngValue]="null" disabled selected>Choisir une colonne</option>
            @for (h of headers; track h) {
              <option [ngValue]="h">{{ h }}</option>
            }
          </select>
        </div>
        <div class="form-group">
          <label>Début d'adhésion</label>
          <select [(ngModel)]="adhesionStartCol" (ngModelChange)="onMappingChange()">
            <option [ngValue]="null" disabled selected>Choisir une colonne</option>
            @for (h of headers; track h) {
              <option [ngValue]="h">{{ h }}</option>
            }
          </select>
        </div>
        <div class="form-group">
          <label>Fin d'adhésion</label>
          <select [(ngModel)]="adhesionEndCol" (ngModelChange)="onMappingChange()">
            <option [ngValue]="null" disabled selected>Choisir une colonne</option>
            @for (h of headers; track h) {
              <option [ngValue]="h">{{ h }}</option>
            }
          </select>
        </div>
      </div>
    </section>

    <section class="preview-section">
      <h2>Exporter</h2>
      <div class="form-group">
        <label>Nom du fichier d'exportation</label>
        <input type="text" [(ngModel)]="exportPath" placeholder="adherents.csv" readonly>
      </div>
      <button (click)="exportData()" [disabled]="!canExport">
        Exporter CSV
      </button>
      @if (!canExport) {
        <p class="preview-note">Sélectionnez les quatre champs pour activer l'exportation.</p>
      }

      @if (statusMessage) {
        <div class="status-message">
          <pre>{{ statusMessage }}</pre>
        </div>
      }
    </section>
  }
</div>

<router-outlet/>
